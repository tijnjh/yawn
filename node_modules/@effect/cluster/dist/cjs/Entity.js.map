{"version":3,"file":"Entity.js","names":["RpcClient","_interopRequireWildcard","require","RpcGroup","RpcServer","Arr","Cause","Context","Data","Effect","Equal","Exit","FiberId","_Function","Hash","Layer","Mailbox","Option","Predicate","_Scope","_ClusterSchema","_EntityAddress","_EntityType","Envelope","_hash","_resourceMap","_RunnerAddress","ShardId","_ShardingConfig","Snowflake","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","TypeId","exports","Symbol","for","isEntity","u","hasProperty","Proto","symbol","structure","type","that","annotate","tag","value","fromRpcGroup","protocol","annotateRpcs","annotateContext","context","annotateRpcsContext","getShardId","entityId","map","shardingTag","sharding","getShardGroup","client","pipe","flatMap","makeClient","toLayer","build","options","registerEntity","isEffect","succeed","effectDiscard","of","identity","toLayerMailbox","buildHandlers","gen","behaviour","mailbox","make","handler","envelope","async","resume","unsafeOffer","resumes","handlers","rpc","requests","keys","Map","complete","request","exit","sync","delete","replier","fail","error","failCause","cause","catchAllCause","values","void","interruptible","forkScoped","concurrency","self","create","EntityType","annotations","ShardGroup","CurrentAddress","Tag","CurrentRunnerAddress","Request","Class","lastSentChunkValue","lastSentChunk","chunk","lastNonEmpty","nextSequence","isNone","sequence","GenericTag","fiberIdIgnored","interruptIgnored","interrupt","makeTestClient","fnUntraced","entity","layer","config","ShardingConfig","makeShardId","Math","abs","hashString","shardsPerGroup","snowflakeGen","makeGenerator","runnerAddress","RunnerAddress","host","port","entityMap","contextWith","toHandlersContext","provide","add","omit","Scope","entityEntry","dieMessage","ResourceMap","address","EntityAddress","entityType","shardId","provideService","server","makeNoSerialization","onFromServer","response","write","supportsAck","generateRequestId","unsafeNext","onFromClient","message","_tag","payload","requestId","id","none"],"sources":["../../src/Entity.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}