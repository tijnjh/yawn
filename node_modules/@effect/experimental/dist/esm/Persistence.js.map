{"version":3,"file":"Persistence.js","names":["TypeIdError","KeyValueStore","Arr","Context","Duration","Effect","identity","Layer","Option","ParseResult","PrimaryKey","Schema","ErrorTypeId","Symbol","for","PersistenceParseError","make","method","error","reason","message","TreeFormatter","formatIssueSync","PersistenceBackingError","cause","BackingPersistenceTypeId","BackingPersistence","GenericTag","ResultPersistenceTypeId","ResultPersistence","layerResult","effect","gen","backing","of","options","storage","storeId","timeToLive","infinity","parse","key","value","mapError","deserializeExit","_","issue","encode","serializeExit","makeKey","symbol","get","flatMap","match","onNone","succeedNone","onSome","asSome","getMany","keys","map","forEach","result","i","pipe","tapError","remove","option","set","ttl","decode","isZero","void","encoded","isFinite","some","none","setMany","fnUntraced","entries","encodedEntries","empty","push","length","catchAll","fail","clear","layerMemory","sync","stores","Map","getStore","store","undefined","clock","unsafeGet","unsafeCurrentTimeMillis","delete","unsafeTtlToExpires","layerKeyValueStore","prefix","s","try","JSON","catch","Array","isArray","expires","as","ignore","succeed","concurrency","stringify","u","discard","layerResultMemory","provide","layerResultKeyValueStore","_tag","toMillis"],"sources":["../../src/Persistence.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,SAASA,WAAW,QAAQ,wBAAwB;AACpD,OAAO,KAAKC,aAAa,MAAM,gCAAgC;AAC/D,OAAO,KAAKC,GAAG,MAAM,cAAc;AAEnC,OAAO,KAAKC,OAAO,MAAM,gBAAgB;AACzC,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,OAAO,KAAKC,MAAM,MAAM,eAAe;AAEvC,SAASC,QAAQ,QAAQ,iBAAiB;AAC1C,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,WAAW,MAAM,oBAAoB;AACjD,OAAO,KAAKC,UAAU,MAAM,mBAAmB;AAC/C,OAAO,KAAKC,MAAM,MAAM,eAAe;AAGvC;;;;AAIA,OAAO,MAAMC,WAAW,gBAAkBC,MAAM,CAACC,GAAG,CAAC,uCAAuC,CAAC;AAc7F;;;;AAIA,OAAM,MAAOC,qBAAsB,sBAAQf,WAAW,CAACY,WAAW,EAAE,kBAAkB,CAIpF;EACA;;;EAGA,OAAOI,IAAIA,CAACC,MAAc,EAAEC,KAAsC;IAChE,OAAO,IAAIH,qBAAqB,CAAC;MAAEI,MAAM,EAAE,YAAY;MAAEF,MAAM;MAAEC;IAAK,CAAE,CAAC;EAC3E;EAEA,IAAIE,OAAOA,CAAA;IACT,OAAOX,WAAW,CAACY,aAAa,CAACC,eAAe,CAAC,IAAI,CAACJ,KAAK,CAAC;EAC9D;;AAGF;;;;AAIA,OAAM,MAAOK,uBAAwB,sBAAQvB,WAAW,CAACY,WAAW,EAAE,kBAAkB,CAItF;EACA;;;EAGA,OAAOI,IAAIA,CAACC,MAAc,EAAEO,KAAc;IACxC,OAAO,IAAID,uBAAuB,CAAC;MAAEJ,MAAM,EAAE,cAAc;MAAEF,MAAM;MAAEO;IAAK,CAAE,CAAC;EAC/E;EAEA,IAAIJ,OAAOA,CAAA;IACT,OAAO,IAAI,CAACD,MAAM;EACpB;;AAGF;;;;AAIA,OAAO,MAAMM,wBAAwB,gBAAkBZ,MAAM,CAACC,GAAG,CAAC,yCAAyC,CAAC;AAoC5G;;;;AAIA,OAAO,MAAMY,kBAAkB,gBAAwDvB,OAAO,CAACwB,UAAU,CAGvG,yCAAyC,CAC1C;AAED;;;;AAIA,OAAO,MAAMC,uBAAuB,gBAAkBf,MAAM,CAACC,GAAG,CAAC,wCAAwC,CAAC;AAqF1G;;;;AAIA,OAAO,MAAMe,iBAAiB,gBAAsD1B,OAAO,CAACwB,UAAU,CAGpG,wCAAwC,CACzC;AAED;;;;AAIA,OAAO,MAAMG,WAAW,gBAAGvB,KAAK,CAACwB,MAAM,CACrCF,iBAAiB,eACjBxB,MAAM,CAAC2B,GAAG,CAAC,aAAS;EAClB,MAAMC,OAAO,GAAG,OAAOP,kBAAkB;EACzC,OAAOG,iBAAiB,CAACK,EAAE,CAAC;IAC1B,CAACN,uBAAuB,GAAGA,uBAAuB;IAClDZ,IAAI,EAAGmB,OAAO,IACZ9B,MAAM,CAAC2B,GAAG,CAAC,aAAS;MAClB,MAAMI,OAAO,GAAG,OAAOH,OAAO,CAACjB,IAAI,CAACmB,OAAO,CAACE,OAAO,CAAC;MACpD,MAAMC,UAAU,GAAGH,OAAO,CAACG,UAAU,KAAK,MAAMlC,QAAQ,CAACmC,QAAQ,CAAC;MAClE,MAAMC,KAAK,GAAGA,CACZvB,MAAc,EACdwB,GAA2C,EAC3CC,KAAc,KAEdrC,MAAM,CAACsC,QAAQ,CACbhC,MAAM,CAACiC,eAAe,CAACH,GAAG,EAAEC,KAAK,CAAC,EACjCG,CAAC,IAAK9B,qBAAqB,CAACC,IAAI,CAACC,MAAM,EAAE4B,CAAC,CAACC,KAAK,CAAC,CACnD;MACH,MAAMC,MAAM,GAAGA,CACb9B,MAAc,EACdwB,GAA2C,EAC3CC,KAAsB,KAEtBrC,MAAM,CAACsC,QAAQ,CACbhC,MAAM,CAACqC,aAAa,CAACP,GAAG,EAAEC,KAAK,CAAC,EAC/BG,CAAC,IAAK9B,qBAAqB,CAACC,IAAI,CAACC,MAAM,EAAE4B,CAAC,CAACC,KAAK,CAAC,CACnD;MACH,MAAMG,OAAO,GACXR,GAA2C,IACxCA,GAAG,CAAC/B,UAAU,CAACwC,MAAM,CAAC,EAAE;MAE7B,OAAO5C,QAAQ,CAAyB;QACtC6C,GAAG,EAAGV,GAAG,IACPpC,MAAM,CAAC+C,OAAO,CACZhB,OAAO,CAACe,GAAG,CAACF,OAAO,CAACR,GAAG,CAAC,CAAC,EACzBjC,MAAM,CAAC6C,KAAK,CAAC;UACXC,MAAM,EAAEA,CAAA,KAAMjD,MAAM,CAACkD,WAAW;UAChCC,MAAM,EAAGX,CAAC,IAAKxC,MAAM,CAACoD,MAAM,CAACjB,KAAK,CAAC,KAAK,EAAEC,GAAG,EAAEI,CAAC,CAAC;SAClD,CAAC,CACH;QACHa,OAAO,EAAGC,IAAI,IACZtD,MAAM,CAAC+C,OAAO,CACZhB,OAAO,CAACsB,OAAO,CAACC,IAAI,CAACC,GAAG,CAACX,OAAO,CAAC,CAAC,EAClC5C,MAAM,CAACwD,OAAO,CAAC,CAACC,MAAM,EAAEC,CAAC,KAAI;UAC3B,MAAMtB,GAAG,GAAGkB,IAAI,CAACI,CAAC,CAAC;UACnB,OAAOvD,MAAM,CAAC6C,KAAK,CAACS,MAAM,EAAE;YAC1BR,MAAM,EAAEA,CAAA,KAAMjD,MAAM,CAACkD,WAAW;YAChCC,MAAM,EAAGX,CAAC,IACRL,KAAK,CAAC,SAAS,EAAEC,GAAG,EAAEI,CAAC,CAAC,CAACmB,IAAI,CAC3B3D,MAAM,CAAC4D,QAAQ,CAAEpB,CAAC,IAAKT,OAAO,CAAC8B,MAAM,CAACjB,OAAO,CAACU,IAAI,CAACI,CAAC,CAAC,CAAC,CAAC,CAAC,EACxD1D,MAAM,CAAC8D,MAAM;WAElB,CAAC;QACJ,CAAC,CAAC,CACH;QACHC,GAAG,EAAEA,CAAC3B,GAAG,EAAEC,KAAK,KAAI;UAClB,MAAM2B,GAAG,GAAGjE,QAAQ,CAACkE,MAAM,CAAChC,UAAU,CAACG,GAAG,EAAEC,KAAK,CAAC,CAAC;UACnD,IAAItC,QAAQ,CAACmE,MAAM,CAACF,GAAG,CAAC,EAAE;YACxB,OAAOhE,MAAM,CAACmE,IAAI;UACpB;UACA,OAAOzB,MAAM,CAAC,KAAK,EAAEN,GAAG,EAAEC,KAAK,CAAC,CAACsB,IAAI,CACnC3D,MAAM,CAAC+C,OAAO,CAAEqB,OAAO,IACrBrC,OAAO,CAACgC,GAAG,CAACnB,OAAO,CAACR,GAAG,CAAC,EAAEgC,OAAO,EAAErE,QAAQ,CAACsE,QAAQ,CAACL,GAAG,CAAC,GAAG7D,MAAM,CAACmE,IAAI,CAACN,GAAG,CAAC,GAAG7D,MAAM,CAACoE,IAAI,EAAE,CAAC,CAC9F,CACF;QACH,CAAC;QACDC,OAAO,EAAExE,MAAM,CAACyE,UAAU,CAAC,WAAUC,OAAO;UAC1C,MAAMC,cAAc,GAAG9E,GAAG,CAAC+E,KAAK,EAAgE;UAChG,KAAK,MAAM,CAACxC,GAAG,EAAEC,KAAK,CAAC,IAAIqC,OAAO,EAAE;YAClC,MAAMV,GAAG,GAAGjE,QAAQ,CAACkE,MAAM,CAAChC,UAAU,CAACG,GAAG,EAAEC,KAAK,CAAC,CAAC;YACnD,IAAItC,QAAQ,CAACmE,MAAM,CAACF,GAAG,CAAC,EAAE;YAC1B,MAAMI,OAAO,GAAG,OAAO1B,MAAM,CAAC,SAAS,EAAEN,GAAG,EAAEC,KAAK,CAAC;YACpDsC,cAAc,CAACE,IAAI,CAAC,CAACjC,OAAO,CAACR,GAAG,CAAC,EAAEgC,OAAO,EAAErE,QAAQ,CAACsE,QAAQ,CAACL,GAAG,CAAC,GAAG7D,MAAM,CAACmE,IAAI,CAACN,GAAG,CAAC,GAAG7D,MAAM,CAACoE,IAAI,EAAE,CAAC,CAAC;UACzG;UACA,IAAII,cAAc,CAACG,MAAM,KAAK,CAAC,EAAE;UACjC,OAAO,OAAO/C,OAAO,CAACyC,OAAO,CAACG,cAAc,CAAC,CAAChB,IAAI,CAChD3D,MAAM,CAAC+E,QAAQ,CAAElE,KAAK,IAAKb,MAAM,CAACgF,IAAI,CAAC9D,uBAAuB,CAACP,IAAI,CAAC,SAAS,EAAEE,KAAK,CAAC,CAAC,CAAC,CACxF;QACH,CAAC,CAAC;QACFgD,MAAM,EAAGzB,GAAG,IAAKL,OAAO,CAAC8B,MAAM,CAACjB,OAAO,CAACR,GAAG,CAAC,CAAC;QAC7C6C,KAAK,EAAElD,OAAO,CAACkD;OAChB,CAAC;IACJ,CAAC;GACJ,CAAC;AACJ,CAAC,CAAC,CACH;AAED;;;;AAIA,OAAO,MAAMC,WAAW,gBAAoChF,KAAK,CAACiF,IAAI,CACpE9D,kBAAkB,EAClB,MAAK;EACH,MAAM+D,MAAM,GAAG,IAAIC,GAAG,EAAmE;EACzF,MAAMC,QAAQ,GAAItD,OAAe,IAAI;IACnC,IAAIuD,KAAK,GAAGH,MAAM,CAACtC,GAAG,CAACd,OAAO,CAAC;IAC/B,IAAIuD,KAAK,KAAKC,SAAS,EAAE;MACvBD,KAAK,GAAG,IAAIF,GAAG,EAAsD;MACrED,MAAM,CAACrB,GAAG,CAAC/B,OAAO,EAAEuD,KAAK,CAAC;IAC5B;IACA,OAAOA,KAAK;EACd,CAAC;EACD,OAAOlE,kBAAkB,CAACQ,EAAE,CAAC;IAC3B,CAACT,wBAAwB,GAAGA,wBAAwB;IACpDT,IAAI,EAAGqB,OAAO,IACZhC,MAAM,CAACuD,GAAG,CAACvD,MAAM,CAACyF,KAAK,EAAGA,KAAK,IAAI;MACjC,MAAMlC,GAAG,GAAG+B,QAAQ,CAACtD,OAAO,CAAC;MAC7B,MAAM0D,SAAS,GAAItD,GAAW,IAA4B;QACxD,MAAMC,KAAK,GAAGkB,GAAG,CAACT,GAAG,CAACV,GAAG,CAAC;QAC1B,IAAIC,KAAK,KAAKmD,SAAS,EAAE;UACvB,OAAOrF,MAAM,CAACoE,IAAI,EAAE;QACtB,CAAC,MAAM,IAAIlC,KAAK,CAAC,CAAC,CAAC,KAAK,IAAI,IAAIA,KAAK,CAAC,CAAC,CAAC,IAAIoD,KAAK,CAACE,uBAAuB,EAAE,EAAE;UAC3EpC,GAAG,CAACqC,MAAM,CAACxD,GAAG,CAAC;UACf,OAAOjC,MAAM,CAACoE,IAAI,EAAE;QACtB;QACA,OAAOpE,MAAM,CAACmE,IAAI,CAACjC,KAAK,CAAC,CAAC,CAAC,CAAC;MAC9B,CAAC;MACD,OAAOpC,QAAQ,CAA0B;QACvC6C,GAAG,EAAGV,GAAG,IAAKpC,MAAM,CAACmF,IAAI,CAAC,MAAMO,SAAS,CAACtD,GAAG,CAAC,CAAC;QAC/CiB,OAAO,EAAGC,IAAI,IAAKtD,MAAM,CAACmF,IAAI,CAAC,MAAM7B,IAAI,CAACC,GAAG,CAACmC,SAAS,CAAC,CAAC;QACzD3B,GAAG,EAAEA,CAAC3B,GAAG,EAAEC,KAAK,EAAE2B,GAAG,KAAKhE,MAAM,CAACmF,IAAI,CAAC,MAAM5B,GAAG,CAACQ,GAAG,CAAC3B,GAAG,EAAE,CAACC,KAAK,EAAEwD,kBAAkB,CAACJ,KAAK,EAAEzB,GAAG,CAAC,CAAC,CAAC,CAAC;QAClGQ,OAAO,EAAGE,OAAO,IACf1E,MAAM,CAACmF,IAAI,CAAC,MAAK;UACf,KAAK,MAAM,CAAC/C,GAAG,EAAEC,KAAK,EAAE2B,GAAG,CAAC,IAAIU,OAAO,EAAE;YACvCnB,GAAG,CAACQ,GAAG,CAAC3B,GAAG,EAAE,CAACC,KAAK,EAAEwD,kBAAkB,CAACJ,KAAK,EAAEzB,GAAG,CAAC,CAAC,CAAC;UACvD;QACF,CAAC,CAAC;QACJH,MAAM,EAAGzB,GAAG,IAAKpC,MAAM,CAACmF,IAAI,CAAC,MAAM5B,GAAG,CAACqC,MAAM,CAACxD,GAAG,CAAC,CAAC;QACnD6C,KAAK,EAAEjF,MAAM,CAACmF,IAAI,CAAC,MAAM5B,GAAG,CAAC0B,KAAK,EAAE;OACrC,CAAC;IACJ,CAAC;GACJ,CAAC;AACJ,CAAC,CACF;AAED;;;;AAIA,OAAO,MAAMa,kBAAkB,gBAAwE5F,KAAK,CAACwB,MAAM,CACjHL,kBAAkB,eAClBrB,MAAM,CAAC2B,GAAG,CAAC,aAAS;EAClB,MAAMC,OAAO,GAAG,OAAOhC,aAAa,CAACA,aAAa;EAClD,OAAOyB,kBAAkB,CAACQ,EAAE,CAAC;IAC3B,CAACT,wBAAwB,GAAGA,wBAAwB;IACpDT,IAAI,EAAGqB,OAAO,IACZhC,MAAM,CAACuD,GAAG,CAACvD,MAAM,CAACyF,KAAK,EAAGA,KAAK,IAAI;MACjC,MAAMF,KAAK,GAAG3F,aAAa,CAACmG,MAAM,CAACnE,OAAO,EAAEI,OAAO,CAAC;MACpD,MAAMc,GAAG,GAAGA,CAAClC,MAAc,EAAEwB,GAAW,KACtCpC,MAAM,CAAC+C,OAAO,CACZ/C,MAAM,CAACsC,QAAQ,CACbiD,KAAK,CAACzC,GAAG,CAACV,GAAG,CAAC,EACbvB,KAAK,IAAKK,uBAAuB,CAACP,IAAI,CAACC,MAAM,EAAEC,KAAK,CAAC,CACvD,EACDV,MAAM,CAAC6C,KAAK,CAAC;QACXC,MAAM,EAAEA,CAAA,KAAMjD,MAAM,CAACkD,WAAW;QAChCC,MAAM,EAAG6C,CAAC,IACRhG,MAAM,CAAC+C,OAAO,CACZ/C,MAAM,CAACiG,GAAG,CAAC;UACTA,GAAG,EAAEA,CAAA,KAAMC,IAAI,CAAC/D,KAAK,CAAC6D,CAAC,CAAC;UACxBG,KAAK,EAAGtF,KAAK,IAAKK,uBAAuB,CAACP,IAAI,CAACC,MAAM,EAAEC,KAAK;SAC7D,CAAC,EACD2B,CAAC,IAAI;UACJ,IAAI,CAAC4D,KAAK,CAACC,OAAO,CAAC7D,CAAC,CAAC,EAAE,OAAOxC,MAAM,CAACkD,WAAW;UAChD,MAAM,CAACb,KAAK,EAAEiE,OAAO,CAAC,GAAG9D,CAA6B;UACtD,IAAI8D,OAAO,KAAK,IAAI,IAAIA,OAAO,IAAIb,KAAK,CAACE,uBAAuB,EAAE,EAAE;YAClE,OAAO3F,MAAM,CAACuG,EAAE,CAACvG,MAAM,CAACwG,MAAM,CAACjB,KAAK,CAAC1B,MAAM,CAACzB,GAAG,CAAC,CAAC,EAAEjC,MAAM,CAACoE,IAAI,EAAE,CAAC;UACnE;UACA,OAAOvE,MAAM,CAACyG,OAAO,CAACtG,MAAM,CAACmE,IAAI,CAACjC,KAAK,CAAC,CAAC;QAC3C,CAAC;OAEN,CAAC,CACH;MACH,OAAOpC,QAAQ,CAA0B;QACvC6C,GAAG,EAAGV,GAAG,IAAKU,GAAG,CAAC,KAAK,EAAEV,GAAG,CAAC;QAC7BiB,OAAO,EAAGC,IAAI,IAAKtD,MAAM,CAACwD,OAAO,CAACF,IAAI,EAAGlB,GAAG,IAAKU,GAAG,CAAC,SAAS,EAAEV,GAAG,CAAC,EAAE;UAAEsE,WAAW,EAAE;QAAW,CAAE,CAAC;QACnG3C,GAAG,EAAEA,CAAC3B,GAAG,EAAEC,KAAK,EAAE2B,GAAG,KACnBhE,MAAM,CAAC+C,OAAO,CACZ/C,MAAM,CAACiG,GAAG,CAAC;UACTA,GAAG,EAAEA,CAAA,KAAMC,IAAI,CAACS,SAAS,CAAC,CAACtE,KAAK,EAAEwD,kBAAkB,CAACJ,KAAK,EAAEzB,GAAG,CAAC,CAAC,CAAC;UAClEmC,KAAK,EAAGtF,KAAK,IAAKK,uBAAuB,CAACP,IAAI,CAAC,KAAK,EAAEE,KAAK;SAC5D,CAAC,EACD+F,CAAC,IACA5G,MAAM,CAACsC,QAAQ,CACbiD,KAAK,CAACxB,GAAG,CAAC3B,GAAG,EAAEwE,CAAC,CAAC,EAChB/F,KAAK,IAAKK,uBAAuB,CAACP,IAAI,CAAC,KAAK,EAAEE,KAAK,CAAC,CACtD,CACJ;QACH2D,OAAO,EAAGE,OAAO,IACf1E,MAAM,CAACwD,OAAO,CAACkB,OAAO,EAAE,CAAC,CAACtC,GAAG,EAAEC,KAAK,EAAE2B,GAAG,CAAC,KAAI;UAC5C,MAAMsC,OAAO,GAAGT,kBAAkB,CAACJ,KAAK,EAAEzB,GAAG,CAAC;UAC9C,IAAIsC,OAAO,KAAK,IAAI,EAAE,OAAOtG,MAAM,CAACmE,IAAI;UACxC,MAAMC,OAAO,GAAG8B,IAAI,CAACS,SAAS,CAAC,CAACtE,KAAK,EAAEiE,OAAO,CAAC,CAAC;UAChD,OAAOf,KAAK,CAACxB,GAAG,CAAC3B,GAAG,EAAEgC,OAAO,CAAC;QAChC,CAAC,EAAE;UAAEsC,WAAW,EAAE,WAAW;UAAEG,OAAO,EAAE;QAAI,CAAE,CAAC,CAAClD,IAAI,CAClD3D,MAAM,CAACsC,QAAQ,CAAEzB,KAAK,IAAKK,uBAAuB,CAACP,IAAI,CAAC,SAAS,EAAEE,KAAK,CAAC,CAAC,CAC3E;QACHgD,MAAM,EAAGzB,GAAG,IACVpC,MAAM,CAACsC,QAAQ,CACbiD,KAAK,CAAC1B,MAAM,CAACzB,GAAG,CAAC,EAChBvB,KAAK,IAAKK,uBAAuB,CAACP,IAAI,CAAC,QAAQ,EAAEE,KAAK,CAAC,CACzD;QACHoE,KAAK,EAAEjF,MAAM,CAACsC,QAAQ,CAACiD,KAAK,CAACN,KAAK,EAAGpE,KAAK,IAAKK,uBAAuB,CAACP,IAAI,CAAC,OAAO,EAAEE,KAAK,CAAC;OAC5F,CAAC;IACJ,CAAC;GACJ,CAAC;AACJ,CAAC,CAAC,CACH;AAED;;;;AAIA,OAAO,MAAMiG,iBAAiB,gBAAmCrF,WAAW,CAACkC,IAAI,cAC/EzD,KAAK,CAAC6G,OAAO,CAAC7B,WAAW,CAAC,CAC3B;AAED;;;;AAIA,OAAO,MAAM8B,wBAAwB,gBAAuEvF,WAAW,CACpHkC,IAAI,cACHzD,KAAK,CAAC6G,OAAO,CAACjB,kBAAkB,CAAC,CAClC;AAEH;;;AAGA,OAAO,MAAMD,kBAAkB,GAAGA,CAACJ,KAAkB,EAAEzB,GAAqC,KAC1FA,GAAG,CAACiD,IAAI,KAAK,MAAM,GAAG,IAAI,GAAGxB,KAAK,CAACE,uBAAuB,EAAE,GAAG5F,QAAQ,CAACmH,QAAQ,CAAClD,GAAG,CAAC3B,KAAK,CAAC","ignoreList":[]}