{"version":3,"file":"RpcSerialization.js","names":["Context","Layer","hasProperty","Msgpackr","RpcSerialization","Tag","json","of","contentType","includesFraming","unsafeMake","decoder","TextDecoder","decode","bytes","JSON","parse","encode","response","stringify","ndjson","buffer","position","nlIndex","indexOf","items","item","slice","push","Array","isArray","length","undefined","data","i","jsonRpc","options","batches","Map","decoded","decodeJsonRpcRaw","map","encodeJsonRpcMessage","encoded","encodeJsonRpcRaw","ndJsonRpc","parser","frames","messages","frame","batch","size","responses","message","decodeJsonRpcMessage","_tag","set","id","method","startsWith","tag","requestId","params","String","payload","headers","traceId","spanId","sampled","error","defect","chunk","values","result","exit","cause","value","get","delete","from","jsonrpc","Number","code","jsonRpcInternalError","msgPack","unpackr","Unpackr","packr","Packr","encoder","TextEncoder","incomplete","buf","prev","Uint8Array","unpackMultiple","error_","subarray","lastPosition","pack","layerJson","succeed","layerNdjson","layerJsonRpc","layerNdJsonRpc","layerMsgPack"],"sources":["../../src/RpcSerialization.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}