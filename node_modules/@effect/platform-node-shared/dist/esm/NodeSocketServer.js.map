{"version":3,"file":"NodeSocketServer.js","names":["Socket","SocketServer","Context","Deferred","Effect","Exit","FiberRef","FiberSet","pipe","Layer","Scope","Net","WS","NodeSocket","IncomingMessage","Tag","make","fnUntraced","options","errorDeferred","pending","defaultOnConnection","socket","push","onConnection","addFinalizer","async","resume","server","close","void","createServer","conn","on","cause","unsafeDone","fail","listen","raceFirst","mapError","await","SocketServerError","reason","run","handler","scope","fiberSet","extend","runtime","onConnection_","error","err","fromDuplex","acquireRelease","suspend","SocketGenericError","closed","SocketCloseError","code","succeed","sync","destroySoon","flatMap","catchAllCause","reportUnhandledError","provideService","NetSocket","_resume","prev","forEach","length","address","of","_tag","path","hostname","port","layer","scoped","makeWebSocket","WebSocketServer","once","req","fromWebSocket","WebSocket","off","ensuring","layerWebSocket","withFiberRuntime","fiber","unhandledLogLevel","getFiberRef","unhandledErrorLogLevel","logWithLevel","value"],"sources":["../../src/NodeSocketServer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}