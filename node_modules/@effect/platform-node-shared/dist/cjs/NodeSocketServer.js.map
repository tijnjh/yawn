{"version":3,"file":"NodeSocketServer.js","names":["Socket","_interopRequireWildcard","require","SocketServer","Context","Deferred","Effect","Exit","FiberRef","FiberSet","_Function","Layer","Scope","Net","WS","NodeSocket","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","IncomingMessage","Tag","exports","make","fnUntraced","options","errorDeferred","pending","defaultOnConnection","socket","push","onConnection","addFinalizer","async","resume","server","close","void","createServer","conn","on","cause","unsafeDone","fail","listen","pipe","raceFirst","mapError","await","SocketServerError","reason","run","handler","scope","fiberSet","extend","runtime","onConnection_","error","err","fromDuplex","acquireRelease","suspend","SocketGenericError","closed","SocketCloseError","code","succeed","sync","destroySoon","flatMap","catchAllCause","reportUnhandledError","provideService","NetSocket","_resume","prev","forEach","length","address","of","_tag","path","hostname","port","layer","scoped","makeWebSocket","WebSocketServer","once","req","fromWebSocket","WebSocket","off","ensuring","layerWebSocket","withFiberRuntime","fiber","unhandledLogLevel","getFiberRef","unhandledErrorLogLevel","logWithLevel","value"],"sources":["../../src/NodeSocketServer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}