{"version":3,"file":"httpMiddleware.js","names":["Context","Effect","FiberRef","constFalse","dual","Function","globalValue","Layer","Option","Headers","ServerError","ServerRequest","ServerResponse","TraceContext","internalHttpApp","make","middleware","loggerDisabled","Symbol","for","unsafeMake","withLoggerDisabled","self","zipRight","set","currentTracerDisabledWhen","withTracerDisabledWhen","pred","locally","withTracerDisabledWhenEffect","withTracerDisabledForUrls","urls","req","includes","url","SpanNameGenerator","Reference","defaultValue","request","method","withSpanNameGenerator","f","provide","succeed","logger","httpApp","counter","withFiberRuntime","fiber","unsafeGet","currentContext","HttpServerRequest","withLogSpan","flatMap","exit","getFiberRef","_tag","response","cause","causeResponseStripped","annotateLogs","log","value","status","tracer","disabled","getOrUndefined","toURL","undefined","username","password","redactedHeaderNames","currentRedactedNames","redactedHeaders","redact","headers","nameGenerator","get","useSpan","parent","fromHeaders","kind","captureStackTrace","span","attribute","toString","pathname","query","search","slice","protocol","name","String","remoteAddress","withParentSpan","exitResponse","xForwardedHeaders","updateService","host","split","trim","modify","searchParamsParser","context","params","searchParamsFromURL","URL","originalUrl","add","ParsedSearchParams","cors","options","opts","allowedOrigins","allowedMethods","allowedHeaders","exposedHeaders","credentials","isAllowedOrigin","origin","allowOrigin","length","originHeader","vary","constant","allowMethods","join","allowCredentials","allowHeaders","accessControlRequestHeaders","exposeHeaders","maxAge","headersFromRequest","unsafeFromRecord","headersFromRequestOptions","preResponseHandler","setHeaders","empty","appendPreResponseHandler"],"sources":["../../../src/internal/httpMiddleware.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}