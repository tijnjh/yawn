{"version":3,"file":"Migrator.js","names":["Arr","Data","Effect","pipe","Option","Order","Client","MigrationError","TaggedError","make","dumpSchema","void","loader","schemaDirectory","table","gen","sql","SqlClient","ensureMigrationsTable","onDialectOrElse","mssql","literal","mysql","pg","catchAll","orElse","insertMigrations","rows","insert","map","migration_id","name","withoutTransform","latestMigration","_","fromNullable","created_at","id","createdAt","loadMigration","load","catchAllDefect","fail","reason","message","flatMap","isEffect","succeed","default","filterOrFail","runMigration","effect","orDieWith","error","cause","run","latestMigrationId","current","all","match","onNone","onSome","Set","size","length","required","resolved","currentId","currentName","push","mapError","forEach","logDebug","zipRight","annotateLogs","String","discard","toString","completed","withTransaction","catchTag","as","catchAllCause","logInfo","migrationOrder","a","b","number","fromGlob","migrations","Object","keys","filterMap","key","Number","promise","sort","fromBabelGlob","fromRecord"],"sources":["../../src/Migrator.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}