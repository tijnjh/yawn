{"version":3,"file":"Migrator.js","names":["Arr","_interopRequireWildcard","require","Data","Effect","_Function","Option","Order","Client","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","MigrationError","TaggedError","exports","make","dumpSchema","void","loader","schemaDirectory","table","gen","sql","SqlClient","ensureMigrationsTable","onDialectOrElse","mssql","literal","mysql","pg","catchAll","orElse","insertMigrations","rows","insert","map","migration_id","name","withoutTransform","latestMigration","_","fromNullable","created_at","id","createdAt","loadMigration","load","catchAllDefect","fail","reason","message","pipe","flatMap","isEffect","succeed","filterOrFail","runMigration","effect","orDieWith","error","cause","run","latestMigrationId","current","all","match","onNone","onSome","Set","size","length","required","resolved","currentId","currentName","push","mapError","forEach","logDebug","zipRight","annotateLogs","String","discard","toString","completed","withTransaction","catchTag","as","catchAllCause","logInfo","migrationOrder","a","b","number","fromGlob","migrations","keys","filterMap","key","Number","promise","sort","fromBabelGlob","fromRecord"],"sources":["../../src/Migrator.ts"],"sourcesContent":[null],"mappings":";;;;;;AAGA,IAAAA,GAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,IAAA,GAAAF,uBAAA,CAAAC,OAAA;AACA,IAAAE,MAAA,GAAAH,uBAAA,CAAAC,OAAA;AACA,IAAAG,SAAA,GAAAH,OAAA;AACA,IAAAI,MAAA,GAAAL,uBAAA,CAAAC,OAAA;AACA,IAAAK,KAAA,GAAAN,uBAAA,CAAAC,OAAA;AACA,IAAAM,MAAA,GAAAP,uBAAA,CAAAC,OAAA;AAAwC,SAAAD,wBAAAQ,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAV,uBAAA,YAAAA,CAAAQ,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAC,OAAA,EAAAV,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,gBAAAP,CAAA,IAAAD,CAAA,gBAAAC,CAAA,OAAAa,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAC,CAAA,OAAAM,CAAA,IAAAD,CAAA,GAAAU,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAC,CAAA,OAAAM,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAP,CAAA,EAAAM,CAAA,IAAAC,CAAA,CAAAP,CAAA,IAAAD,CAAA,CAAAC,CAAA,WAAAO,CAAA,KAAAR,CAAA,EAAAC,CAAA;AATxC;;;;AAoDA;;;;AAIM,MAAOkB,cAAe,sBAAQzB,IAAI,CAAC0B,WAAW,CAAC,gBAAgB,CAUnE;AAEF;;;;AAAAC,OAAA,CAAAF,cAAA,GAAAA,cAAA;AAIO,MAAMG,IAAI,GAAGA,CAAa;EAC/BC,UAAU,GAAGA,CAAA,KAAM5B,MAAM,CAAC6B;AAAI,CAM/B,KACD,CAAa;EACXC,MAAM;EACNC,eAAe;EACfC,KAAK,GAAG;AAAuB,CACX,KAKpBhC,MAAM,CAACiC,GAAG,CAAC,aAAS;EAClB,MAAMC,GAAG,GAAG,OAAO9B,MAAM,CAAC+B,SAAS;EACnC,MAAMC,qBAAqB,GAAGF,GAAG,CAACG,eAAe,CAAC;IAChDC,KAAK,EAAEA,CAAA,KACLJ,GAAG,kBAAkBA,GAAG,CAACK,OAAO,CAACP,KAAK,CAAC;iBAC9BE,GAAG,CAACF,KAAK,CAAC;;;;IAIvB;IACEQ,KAAK,EAAEA,CAAA,KACLN,GAAG,8BAA8BA,GAAG,CAACF,KAAK,CAAC;;;;;EAKjD;IACIS,EAAE,EAAEA,CAAA,KACFzC,MAAM,CAAC0C,QAAQ,CACbR,GAAG,UAAUF,KAAK,YAAY,EAC9B,MACEE,GAAG,gBAAgBA,GAAG,CAACF,KAAK,CAAC;;;;EAIvC,CACO;IACHW,MAAM,EAAEA,CAAA,KACNT,GAAG,8BAA8BA,GAAG,CAACF,KAAK,CAAC;;;;;GAK9C,CAAC;EAEF,MAAMY,gBAAgB,GACpBC,IAA+C,IAE/CX,GAAG,eAAeA,GAAG,CAACF,KAAK,CAAC,IAC1BE,GAAG,CAACY,MAAM,CACRD,IAAI,CAACE,GAAG,CAAC,CAAC,CAACC,YAAY,EAAEC,IAAI,CAAC,MAAM;IAAED,YAAY;IAAEC;EAAI,CAAE,CAAC,CAAC,CAEhE,EAAE,CAACC,gBAAgB;EAErB,MAAMC,eAAe,GAAGnD,MAAM,CAAC+C,GAAG,CAChCb,GAA6D,8CAC3DA,GAAG,CAACF,KAAK,CACX,6BAA6B,CAACkB,gBAAgB,EAC7CE,CAAC,IACAlD,MAAM,CAAC6C,GAAG,CACR7C,MAAM,CAACmD,YAAY,CAACD,CAAC,CAAC,CAAC,CAAQ,CAAC,EAChC,CAAC;IAAEE,UAAU;IAAEN,YAAY;IAAEC;EAAI,CAAE,MAAiB;IAClDM,EAAE,EAAEP,YAAY;IAChBC,IAAI;IACJO,SAAS,EAAEF;GACZ,CAAC,CACH,CACJ;EAED,MAAMG,aAAa,GAAGA,CAAC,CAACF,EAAE,EAAEN,IAAI,EAAES,IAAI,CAAoB,KACxD1D,MAAM,CAAC2D,cAAc,CAACD,IAAI,EAAGN,CAAC,IAC5BpD,MAAM,CAAC4D,IAAI,CACT,IAAIpC,cAAc,CAAC;IACjBqC,MAAM,EAAE,cAAc;IACtBC,OAAO,EAAE,+BAA+BP,EAAE,IAAIN,IAAI,QAAQG,CAAC;GAC5D,CAAC,CACH,CAAC,CAACW,IAAI,CACL/D,MAAM,CAACgE,OAAO,CAAEZ,CAAC,IACfpD,MAAM,CAACiE,QAAQ,CAACb,CAAC,CAAC,GACdpD,MAAM,CAACkE,OAAO,CAACd,CAAC,CAAC,GACjBA,CAAC,CAACrC,OAAO,GACTf,MAAM,CAACkE,OAAO,CAACd,CAAC,CAACrC,OAAO,EAAEA,OAAO,IAAIqC,CAAC,CAACrC,OAAO,CAAC,GAC/Cf,MAAM,CAAC4D,IAAI,CACX,IAAIpC,cAAc,CAAC;IACjBqC,MAAM,EAAE,cAAc;IACtBC,OAAO,EAAE,2CAA2CP,EAAE,IAAIN,IAAI;GAC/D,CAAC,CACH,CACJ,EACDjD,MAAM,CAACmE,YAAY,CAChBf,CAAC,IAAkCpD,MAAM,CAACiE,QAAQ,CAACb,CAAC,CAAC,EACtD,MACE,IAAI5B,cAAc,CAAC;IACjBqC,MAAM,EAAE,cAAc;IACtBC,OAAO,EAAE,mDAAmDP,EAAE,IAAIN,IAAI;GACvE,CAAC,CACL,CACF;EAEL,MAAMmB,YAAY,GAAGA,CACnBb,EAAU,EACVN,IAAY,EACZoB,MAAyD,KAEzDrE,MAAM,CAACsE,SAAS,CAACD,MAAM,EAAGE,KAAc,IACtC,IAAI/C,cAAc,CAAC;IACjBgD,KAAK,EAAED,KAAK;IACZV,MAAM,EAAE,QAAQ;IAChBC,OAAO,EAAE,cAAcP,EAAE,IAAIN,IAAI;GAClC,CAAC,CAAC;EAEP;EAEA,MAAMwB,GAAG,GAAGzE,MAAM,CAACiC,GAAG,CAAC,aAAS;IAC9B,OAAOC,GAAG,CAACG,eAAe,CAAC;MACzBI,EAAE,EAAEA,CAAA,KAAMP,GAAG,cAAcA,GAAG,CAACF,KAAK,CAAC,2BAA2B;MAChEW,MAAM,EAAEA,CAAA,KAAM3C,MAAM,CAAC6B;KACtB,CAAC;IAEF,MAAM,CAAC6C,iBAAiB,EAAEC,OAAO,CAAC,GAAG,OAAO3E,MAAM,CAAC4E,GAAG,CAAC,CACrD5E,MAAM,CAAC+C,GAAG,CACRI,eAAe,EACfjD,MAAM,CAAC2E,KAAK,CAAC;MACXC,MAAM,EAAEA,CAAA,KAAM,CAAC;MACfC,MAAM,EAAG3B,CAAC,IAAKA,CAAC,CAACG;KAClB,CAAC,CACH,EACDzB,MAAM,CACP,CAAC;IAEF,IAAI,IAAIkD,GAAG,CAACL,OAAO,CAAC5B,GAAG,CAAC,CAAC,CAACQ,EAAE,CAAC,KAAKA,EAAE,CAAC,CAAC,CAAC0B,IAAI,KAAKN,OAAO,CAACO,MAAM,EAAE;MAC9D,OAAO,OAAO,IAAI1D,cAAc,CAAC;QAC/BqC,MAAM,EAAE,YAAY;QACpBC,OAAO,EAAE;OACV,CAAC;IACJ;IAEA,MAAMqB,QAAQ,GAA6B,EAAE;IAE7C,KAAK,MAAMC,QAAQ,IAAIT,OAAO,EAAE;MAC9B,MAAM,CAACU,SAAS,EAAEC,WAAW,CAAC,GAAGF,QAAQ;MACzC,IAAIC,SAAS,IAAIX,iBAAiB,EAAE;QAClC;MACF;MAEAS,QAAQ,CAACI,IAAI,CAAC,CACZF,SAAS,EACTC,WAAW,EACX,OAAO7B,aAAa,CAAC2B,QAAQ,CAAC,CAC/B,CAAC;IACJ;IAEA,IAAID,QAAQ,CAACD,MAAM,GAAG,CAAC,EAAE;MACvB,OAAO,IAAAnB,cAAI,EACTnB,gBAAgB,CAACuC,QAAQ,CAACpC,GAAG,CAAC,CAAC,CAACQ,EAAE,EAAEN,IAAI,CAAC,KAAK,CAACM,EAAE,EAAEN,IAAI,CAAC,CAAC,CAAC,EAC1DjD,MAAM,CAACwF,QAAQ,CAAEpC,CAAC,IAChB,IAAI5B,cAAc,CAAC;QACjBqC,MAAM,EAAE,QAAQ;QAChBC,OAAO,EAAE;OACV,CAAC,CACH,CACF;IACH;IAEA,OAAO9D,MAAM,CAACyF,OAAO,CACnBN,QAAQ,EACR,CAAC,CAAC5B,EAAE,EAAEN,IAAI,EAAEoB,MAAM,CAAC,KACjBrE,MAAM,CAAC0F,QAAQ,CAAC,mBAAmB,CAAC,CAAC3B,IAAI,CACvC/D,MAAM,CAAC2F,QAAQ,CAACvB,YAAY,CAACb,EAAE,EAAEN,IAAI,EAAEoB,MAAM,CAAC,CAAC,EAC/CrE,MAAM,CAAC4F,YAAY,CAAC,cAAc,EAAEC,MAAM,CAACtC,EAAE,CAAC,CAAC,EAC/CvD,MAAM,CAAC4F,YAAY,CAAC,gBAAgB,EAAE3C,IAAI,CAAC,CAC5C,EACH;MAAE6C,OAAO,EAAE;IAAI,CAAE,CAClB;IAED,OAAO,IAAA/B,cAAI,EACTZ,eAAe,EACfnD,MAAM,CAACgE,OAAO,CACZ9D,MAAM,CAAC2E,KAAK,CAAC;MACXC,MAAM,EAAEA,CAAA,KAAM9E,MAAM,CAAC0F,QAAQ,CAAC,qBAAqB,CAAC;MACpDX,MAAM,EAAG3B,CAAC,IACRpD,MAAM,CAAC0F,QAAQ,CAAC,qBAAqB,CAAC,CAAC3B,IAAI,CACzC/D,MAAM,CAAC4F,YAAY,CAAC,qBAAqB,EAAExC,CAAC,CAACG,EAAE,CAACwC,QAAQ,EAAE,CAAC,EAC3D/F,MAAM,CAAC4F,YAAY,CAAC,uBAAuB,EAAExC,CAAC,CAACH,IAAI,CAAC;KAEzD,CAAC,CACH,CACF;IAED,OAAOkC,QAAQ,CAACpC,GAAG,CAAC,CAAC,CAACQ,EAAE,EAAEN,IAAI,CAAC,KAAK,CAACM,EAAE,EAAEN,IAAI,CAAU,CAAC;EAC1D,CAAC,CAAC;EAEF,OAAOb,qBAAqB;EAE5B,MAAM4D,SAAS,GAAG,OAAO,IAAAjC,cAAI,EAC3B7B,GAAG,CAAC+D,eAAe,CAACxB,GAAG,CAAC,EACxBzE,MAAM,CAACkG,QAAQ,CAAC,gBAAgB,EAAG9C,CAAC,IAClCA,CAAC,CAACS,MAAM,KAAK,QAAQ,GACjB7D,MAAM,CAACmG,EAAE,CAACnG,MAAM,CAAC0F,QAAQ,CAACtC,CAAC,CAACU,OAAO,CAAC,EAAE,EAAE,CAAC,GACzC9D,MAAM,CAAC4D,IAAI,CAACR,CAAC,CAAC,CAAC,CACtB;EAED,IAAIrB,eAAe,IAAIiE,SAAS,CAACd,MAAM,GAAG,CAAC,EAAE;IAC3C,OAAO,IAAAnB,cAAI,EACTnC,UAAU,CAAC,GAAGG,eAAe,cAAc,EAAEC,KAAK,CAAC,EACnDhC,MAAM,CAACoG,aAAa,CAAE5B,KAAK,IAAKxE,MAAM,CAACqG,OAAO,CAAC,uBAAuB,EAAE7B,KAAK,CAAC,CAAC,CAChF;EACH;EAEA,OAAOwB,SAAS;AAClB,CAAC,CAAC;AAAAtE,OAAA,CAAAC,IAAA,GAAAA,IAAA;AAEJ,MAAM2E,cAAc,gBAAGnG,KAAK,CAACwB,IAAI,CAAoB,CAAC,CAAC4E,CAAC,CAAC,EAAE,CAACC,CAAC,CAAC,KAAKrG,KAAK,CAACsG,MAAM,CAACF,CAAC,EAAEC,CAAC,CAAC,CAAC;AAEtF;;;;AAIO,MAAME,QAAQ,GACnBC,UAA8C,IAE9C,IAAA5C,cAAI,EACF1C,MAAM,CAACuF,IAAI,CAACD,UAAU,CAAC,EACvB/G,GAAG,CAACiH,SAAS,CAAEzD,CAAC,IAAKlD,MAAM,CAACmD,YAAY,CAACD,CAAC,CAACyB,KAAK,CAAC,mCAAmC,CAAC,CAAC,CAAC,EACvFjF,GAAG,CAACmD,GAAG,CACL,CAAC,CAAC+D,GAAG,EAAEvD,EAAE,EAAEN,IAAI,CAAC,KAAwB,CACtC8D,MAAM,CAACxD,EAAE,CAAC,EACVN,IAAI,EACJjD,MAAM,CAACgH,OAAO,CAAC,MAAML,UAAU,CAACG,GAAG,CAAC,EAAE,CAAC,CACxC,CACF,EACDlH,GAAG,CAACqH,IAAI,CAACX,cAAc,CAAC,EACxBtG,MAAM,CAACkE,OAAO,CACf;AAEH;;;;AAAAxC,OAAA,CAAAgF,QAAA,GAAAA,QAAA;AAIO,MAAMQ,aAAa,GAAIP,UAA+B,IAC3D,IAAA5C,cAAI,EACF1C,MAAM,CAACuF,IAAI,CAACD,UAAU,CAAC,EACvB/G,GAAG,CAACiH,SAAS,CAAEzD,CAAC,IAAKlD,MAAM,CAACmD,YAAY,CAACD,CAAC,CAACyB,KAAK,CAAC,2BAA2B,CAAC,CAAC,CAAC,EAC/EjF,GAAG,CAACmD,GAAG,CACL,CAAC,CAAC+D,GAAG,EAAEvD,EAAE,EAAEN,IAAI,CAAC,KAAwB,CACtC8D,MAAM,CAACxD,EAAE,CAAC,EACVN,IAAI,EACJjD,MAAM,CAACkE,OAAO,CAACyC,UAAU,CAACG,GAAG,CAAC,CAAC,CAChC,CACF,EACDlH,GAAG,CAACqH,IAAI,CAACX,cAAc,CAAC,EACxBtG,MAAM,CAACkE,OAAO,CACf;AAEH;;;;AAAAxC,OAAA,CAAAwF,aAAA,GAAAA,aAAA;AAIO,MAAMC,UAAU,GAAIR,UAA0E,IACnG,IAAA5C,cAAI,EACF1C,MAAM,CAACuF,IAAI,CAACD,UAAU,CAAC,EACvB/G,GAAG,CAACiH,SAAS,CAAEzD,CAAC,IAAKlD,MAAM,CAACmD,YAAY,CAACD,CAAC,CAACyB,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,EAClEjF,GAAG,CAACmD,GAAG,CACL,CAAC,CAAC+D,GAAG,EAAEvD,EAAE,EAAEN,IAAI,CAAC,KAAwB,CACtC8D,MAAM,CAACxD,EAAE,CAAC,EACVN,IAAI,EACJjD,MAAM,CAACkE,OAAO,CAACyC,UAAU,CAACG,GAAG,CAAC,CAAC,CAChC,CACF,EACDlH,GAAG,CAACqH,IAAI,CAACX,cAAc,CAAC,EACxBtG,MAAM,CAACkE,OAAO,CACf;AAAAxC,OAAA,CAAAyF,UAAA,GAAAA,UAAA","ignoreList":[]}